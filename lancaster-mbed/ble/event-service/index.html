<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Doãn Minh Đăng">
  
  <title>EventService - Microbit Việt Nam</title>
  

  <link rel="shortcut icon" href="../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../lancaster-mbed/resources/bluetooth/style.css" rel="stylesheet">

  <link rel="stylesheet" href="../../../css/custom.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "EventService";
    var mkdocs_page_input_path = "lancaster-mbed/ble/event-service.md";
    var mkdocs_page_url = "/lancaster-mbed/ble/event-service/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script>
  <script src="../../../js/jquery.cookie-1.4.1.min.js"></script>
  <script src="../../../js/nav.js"></script> 
  <script src="../../../lancaster-mbed/resources/bluetooth/functions.js"></script>

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60470603-6', 'help.microbit.vn');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Microbit Việt Nam</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../.." id="Trang chủ" style="font-size:95%;font-weight:bold;">Trang chủ</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="current">
        <a class="current"  id="Nội dung" style="font-size:95%;font-weight:bold;">Nội dung</a>
    </li>
    
        <li class="current">
            <a style="padding-left:50px;" class="current"  id="micro:bit - Mbed - C/C++" onclick="showChildren('micro:bit - Mbed - C/C++')">micro:bit - Mbed - C/C++  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
        </li>
        
        <div style="display:none" id="hidden_micro:bit - Mbed - C/C++">
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Thông tin chung" onclick="showChildren('micro:bit - Mbed - C/C++Thông tin chung')">Thông tin chung  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chung">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../" id="Giới thiệu">Giới thiệu </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../concepts/" id="Các khái niệm">Các khái niệm </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../advanced/" id="Nâng cao">Nâng cao </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../online-toolchains/" id="Phát triển trên web">Phát triển trên web </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../offline-toolchains/" id="Phát triển offline">Phát triển offline </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../device/" id="Phần cứng">Phần cứng </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../help/" id="Giúp đỡ">Giúp đỡ </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="uBit" onclick="showChildren('micro:bit - Mbed - C/C++Thông tin chunguBit')">uBit  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBit">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/" id="Overview">Overview </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/i2c/" id="i2c">i2c </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/storage/" id="storage">storage </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/serial/" id="serial">serial </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/messageBus/" id="messageBus">messageBus </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/button/" id="buttons">buttons </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/display/" id="display">display </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/accelerometer/" id="accelerometer">accelerometer </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/compass/" id="compass">compass </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/thermometer/" id="thermometer">thermometer </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/io/" id="io">io </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../ubit/radio/" id="radio">radio </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Data Types" onclick="showChildren('micro:bit - Mbed - C/C++Thông tin chunguBitData Types')">Data Types  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData Types">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../data-types/image/" id="MicroBitImage">MicroBitImage </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../data-types/event/" id="MicroBitEvent">MicroBitEvent </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../data-types/string/" id="ManagedString">ManagedString </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../data-types/packetbuffer/" id="PacketBuffer">PacketBuffer </a>
                </li>
            
            </div>
        
            <li class="current">
                <a style="padding-left:70px;" class="current"  id="Bluetooth" onclick="showChildren('micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetooth')">Bluetooth  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetooth">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../profile/" id="Profile">Profile </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../accelerometer-service/" id="AccelerometerService">AccelerometerService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../button-service/" id="ButtonService">ButtonService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../dfu-service/" id="DFUService">DFUService </a>
                </li>
            
                <li class="current">
                    <a style="padding-left:90px;" class="current" href="./" id="EventService">EventService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../iopin-service/" id="IOPinService">IOPinService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../led-service/" id="LEDService">LEDService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../magnetometer-service/" id="MagnetometerService">MagnetometerService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../temperature-service/" id="TemperatureService">TemperatureService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../uart-service/" id="UARTService">UARTService </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../ble-connection-events/" id="Connection Events">Connection Events </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Extras" onclick="showChildren('micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras')">Extras  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../extras/light-sensing/" id="MicroBitLightSensor">MicroBitLightSensor </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../extras/spi/" id="SPI">SPI </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../ubit/blemanager/" id="_blemanager">_blemanager </a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras_blemanager">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../ubit/multibutton/" id="_buttonAB">_buttonAB </a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras_blemanager_buttonAB">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../ubit/radioevent/" id="_radioevent">_radioevent </a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras_blemanager_buttonAB_radioevent">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../ubit/radiodatagram/" id="_radiodatagram">_radiodatagram </a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - Mbed - C/C++Thông tin chunguBitData TypesBluetoothExtras_blemanager_buttonAB_radioevent_radiodatagram">
            
            </div>
        
        </div>
    
        <li class="">
            <a style="padding-left:50px;" class=""  id="micro:bit - Micropython" onclick="showChildren('micro:bit - Micropython')">micro:bit - Micropython  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
        </li>
        
        <div style="display:none" id="hidden_micro:bit - Micropython">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../micropython/introduction/" id="Giới thiệu">Giới thiệu </a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - MicropythonGiới thiệu">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Cơ bản" onclick="showChildren('micro:bit - MicropythonGiới thiệuCơ bản')">Cơ bản  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - MicropythonGiới thiệuCơ bản">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../micropython/helloworld/" id="Hello World">Hello World </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../micropython/images/" id="Ảnh">Ảnh </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="micro:bit micropython API" onclick="showChildren('micro:bit - MicropythonGiới thiệuCơ bảnmicro:bit micropython API')">micro:bit micropython API  <i class="fa fa-arrow-circle-down" style="padding-left:5px;font-size:13px;"></i></a>
            </li>
            
            <div style="display:none" id="hidden_micro:bit - MicropythonGiới thiệuCơ bảnmicro:bit micropython API">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../micropython/api/" id="API">API </a>
                </li>
            
            </div>
        
        </div>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../projects/projects/" id="Các dự án" style="font-size:95%;font-weight:bold;">Các dự án</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../license/" id="Bản quyền" style="font-size:95%;font-weight:bold;">Bản quyền</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../contributor/" id="Đóng góp" style="font-size:95%;font-weight:bold;">Đóng góp</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Microbit Việt Nam</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>micro:bit - Mbed - C/C++ &raquo;</li>
        
      
        
          <li>Bluetooth &raquo;</li>
        
      
    
    <li>EventService</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/microbitvn/help.microbit.vn" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="bluetooth-event-service">Bluetooth Event Service<a class="headerlink" href="#bluetooth-event-service" title="Permanent link">#</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>This Bluetooth service is an optional part of the standard Bluetooth profile for the micro:bit. It is a passive service, that can operate transparently in the
background as your main program is running. This service extends the microBitMessageBus over Bluetooth, so that standard MicroBitEvents raised on the device can be transmitted transparently over
Bluetooth and received and processed by connected Bluetooth master device such as a smartphone.  You do not need to explicitly address and API on the service to achieve this.</p>
<h2 id="enabling-the-service">Enabling the Service<a class="headerlink" href="#enabling-the-service" title="Permanent link">#</a></h2>
<p>This service is enabled by default.</p>
<h2 id="bluetooth-service-specification">Bluetooth Service Specification<a class="headerlink" href="#bluetooth-service-specification" title="Permanent link">#</a></h2>
<p>Please see the <a href="../../resources/bluetooth/microbit-profile-V1.9-Level-2.pdf">micro:bit Bluetooth profile specification</a>.</p>
<h2 id="example-applications-for-androidiosandroid">Example Applications for Android/IOS/Android<a class="headerlink" href="#example-applications-for-androidiosandroid" title="Permanent link">#</a></h2>
<h3 id="general-procedures">General Procedures<a class="headerlink" href="#general-procedures" title="Permanent link">#</a></h3>
<p>micro:bit uses an event bus which relays event objects from system components which generate them to other system components which have registered an interest in events of a given type. This principle and capability has been extended to remote devices connected over Bluetooth. Connected clients can indicate the types of event they are interested in and be informed via Bluetooth notifications as and when such events occur. Similarly, micro:bit application code can inform a connected client of events which might happen in or be observed by an application running on the connected device (the client application) and be informed when they occur via Bluetooth write operations. </p>
<p>Event objects consist of a short (2 octets) type and a short (2 octets) value.</p>
<p>When either client application or micro:bit code registers an interest in an event type it may register for all events of that type regardless of the associated value or may specify a particular value which must accompany that event type for it to be of interest.</p>
<p>The Microbit Requirements characteristic allows micro:bit code to inform the client application of a list of one or more event types/values it wants to be informed about if they arise. For example if a client application monitors for incoming SMS messages and defines receipt of an SMS message to be event type 1234 then a micro:bit application could inform the client application it wants to be told when an SMS has been received by declaring its interest in event type 1234 in its MicrobitRequirements characteristic.</p>
<p>The Client Requirements characteristic has a similar purpose but is the mechanism the client application uses to tell the micro:bit application what events it is interested in. Should they arise and notifications have been enabled on the MicrobitEvent characteristic, the client application will receive a Bluetooth notification containing the event object. A micro:bit application which monitors temperature and notifies a smartphone application when the temperature falls below a specified limit or rises above another threshold could use events to notify the client application when either of these things happens.</p>
<p>The MicroBit Event characteristic is used to convey events which have happened on the micro:bit to the connected client. Notifications are normally used but the most recent events for which the client registered can be determined by reading the characteristic value at any time.</p>
<p>The Client Event characteristic is used to convey events which have happened on the client device to the micro:bit. This is achieved through the client application writing one or more events to the characteristic value.</p>
<p>See the profile page and profile reference documentation for data format and UUID details.</p>
<h3 id="android">Android<a class="headerlink" href="#android" title="Permanent link">#</a></h3>
<p><img src="../../resources/bluetooth/event_demo.png" alt="Event Demo"></p>
<h4 id="android-bluetooth-apis">Android Bluetooth APIs<a class="headerlink" href="#android-bluetooth-apis" title="Permanent link">#</a></h4>
<p>Android developers should make themselves familiar with the <a href="http://developer.android.com/guide/topics/connectivity/bluetooth-le.html">Android Bluetooth low energy APIs</a></p>
<h4 id="microbit-ble-demo-android">microbit-ble-demo-android<a class="headerlink" href="#microbit-ble-demo-android" title="Permanent link">#</a></h4>
<p>The open source microbit-ble-demo-android application contains a number of demonstrations of the micro:bit Bluetooth event service including Temperature Alarm and Squirrel Counter. The main body of code for the temperature alarm demonstration can be found in ui.TemperatureAlarmActivity.java except for the Bluetooth operations themselves which are in bluetooth.BleAdapterService which acts as a kind of higher level Bluetooth API for activities to use without needing to directly concern themselves too closely with the Android APIs themselves. In most cases, operations are asynchronous so that the activity code initiates a Bluetooth operation by calling one of the methods in bluetooth.BleAdapterService (e.g. readCharacteristic(....) ) and later receives a message containing the result of the operation from this object via a Handler object. The message is examined in the Handler code and acted upon.</p>
<p>Key parts of the temperature alarm demonstration in this application are explained next.</p>
<h4 id="in-bluetoothbleadapterservice">In bluetooth.BleAdapterService<a class="headerlink" href="#in-bluetoothbleadapterservice" title="Permanent link">#</a></h4>
<pre class="code"><code class="language-java">public static String EVENTSERVICE_SERVICE_UUID = &quot;E95D93AF251D470AA062FA1922DFA9A8&quot;;
public static String MICROBITREQUIREMENTS_CHARACTERISTIC_UUID = &quot;E95DB84C251D470AA062FA1922DFA9A8&quot;;
public static String MICROBITEVENT_CHARACTERISTIC_UUID = &quot;E95D9775251D470AA062FA1922DFA9A8&quot;;
public static String CLIENTREQUIREMENTS_CHARACTERISTIC_UUID = &quot;E95D23C4251D470AA062FA1922DFA9A8&quot;;
public static String CLIENTEVENT_CHARACTERISTIC_UUID = &quot;E95D5404251D470AA062FA1922DFA9A8&quot;;</code></pre>


<h4 id="in-uitemperaturealarmactivity">In ui.TemperatureAlarmActivity<a class="headerlink" href="#in-uitemperaturealarmactivity" title="Permanent link">#</a></h4>
<pre class="code"><code class="language-java">// event variables and values
private byte upper_limit;
private byte lower_limit;

// LE here means Little Endian btw

// micro:bit event codes:
// 9000 = 0x2823 (LE) = temperature alarm. Value=0 means OK, 1 means cold, 2 means hot

// client event codes:
// 9001=0x2923 (LE) = set lower limit, value is the limit value in celsius
// 9002=0x2A23 (LE) = set upper limit, value is the limit value in celsius

private byte [] event_set_lower = { 0x29, 0x23, 0x00, 0x00}; // event 9001
private byte [] event_set_upper = { 0x2A, 0x23, 0x00, 0x00}; // event 9002</code></pre>


<pre class="code"><code class="language-java">// enabling microbit event notifications
bluetooth_le_adapter.setNotificationsState(
                    Utility.normaliseUUID(BleAdapterService.EVENTSERVICE_SERVICE_UUID), 
                    Utility.normaliseUUID(BleAdapterService.MICROBITEVENT_CHARACTERISTIC_UUID), true)                    </code></pre>


<pre class="code"><code class="language-java">short MICROBIT_EVENT_TYPE_TEMPERATURE_ALARM = 9000;
short MICROBIT_EVENT_VALUE_ANY = 0000;
// informing micro:bit of the types of event we want to be informed about
bluetooth_le_adapter.writeCharacteristic(Utility.normaliseUUID(BleAdapterService.EVENTSERVICE_SERVICE_UUID), Utility.normaliseUUID(BleAdapterService.CLIENTREQUIREMENTS_CHARACTERISTIC_UUID), Utility.leBytesFromTwoShorts(Constants.MICROBIT_EVENT_TYPE_TEMPERATURE_ALARM,Constants.MICROBIT_EVENT_VALUE_ANY));</code></pre>


<pre class="code"><code class="language-java">// setting the upper and lower temperature limits 
private void setUpperLimit() {
    // set the value part of this event data
    event_set_upper[2] = Settings.getInstance().getUpper_temperature_limit();
    bluetooth_le_adapter.writeCharacteristic(Utility.normaliseUUID(BleAdapterService.EVENTSERVICE_SERVICE_UUID), Utility.normaliseUUID(BleAdapterService.CLIENTEVENT_CHARACTERISTIC_UUID), event_set_upper);
}

private void setLowerLimit() {
    // set the value part of this event data
    event_set_lower[2] = Settings.getInstance().getLower_temperature_limit();
    bluetooth_le_adapter.writeCharacteristic(Utility.normaliseUUID(BleAdapterService.EVENTSERVICE_SERVICE_UUID), Utility.normaliseUUID(BleAdapterService.CLIENTEVENT_CHARACTERISTIC_UUID), event_set_lower);
}</code></pre>


<pre class="code"><code class="language-java">// handling a MicrobitEvent notification indicating a temperature alarm of &quot;too hot&quot; or &quot;too cold&quot;
case BleAdapterService.NOTIFICATION_RECEIVED:
    bundle = msg.getData();
    service_uuid = bundle.getString(BleAdapterService.PARCEL_SERVICE_UUID);
    characteristic_uuid = bundle.getString(BleAdapterService.PARCEL_CHARACTERISTIC_UUID);
    b = bundle.getByteArray(BleAdapterService.PARCEL_VALUE);
    if (characteristic_uuid.equalsIgnoreCase((Utility.normaliseUUID(BleAdapterService.MICROBITEVENT_CHARACTERISTIC_UUID)))) {
        byte[] event_bytes = new byte[2];
        byte[] value_bytes = new byte[2];
        System.arraycopy(b, 0, event_bytes, 0, 2);
        System.arraycopy(b, 2, value_bytes, 0, 2);
        short event = Utility.shortFromLittleEndianBytes(event_bytes);
        short value = Utility.shortFromLittleEndianBytes(value_bytes);
        Log.d(Constants.TAG, &quot;Temperature Alarm received: event=&quot; + event + &quot; value=&quot; + value);
        if (event == Constants.MICROBIT_EVENT_TYPE_TEMPERATURE_ALARM) {
            setAlarmImage(alarm_image, value);
            setAlarmMessage(value);
        }
    }
    break;</code></pre>


<h4 id="video-demonstrations">Video Demonstrations<a class="headerlink" href="#video-demonstrations" title="Permanent link">#</a></h4>
<h5 id="temperature-alarm">Temperature Alarm<a class="headerlink" href="#temperature-alarm" title="Permanent link">#</a></h5>
<iframe src="https://player.vimeo.com/video/153072501" width="750" height="422" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

<h5 id="buggy-remote-control">Buggy Remote Control<a class="headerlink" href="#buggy-remote-control" title="Permanent link">#</a></h5>
<iframe allowfullscreen="" frameborder="0" height="422" mozallowfullscreen="" src="https://player.vimeo.com/video/162680772" webkitallowfullscreen="" width="750"></iframe>

<h6 id="microbit-code-for-the-buggy-controller">micro:bit code for the buggy controller<a class="headerlink" href="#microbit-code-for-the-buggy-controller" title="Permanent link">#</a></h6>
<pre class="code"><code class="language-cpp">/*
The MIT License (MIT)

Copyright (c) 2016 British Broadcasting Corporation.
This software is provided by Lancaster University by arrangement with the BBC.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the &quot;Software&quot;),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.
*/

#include &quot;MicroBit.h&quot;
#include &quot;MicroBitSamples.h&quot;

#ifdef MICROBIT_GAMEPAD

MicroBit uBit;

#define MES_DPAD_CONTROLLER                 1104
#define MES_DPAD_1_BUTTON_UP_ON             1
#define MES_DPAD_1_BUTTON_UP_OFF            2
#define MES_DPAD_1_BUTTON_DOWN_ON           3
#define MES_DPAD_1_BUTTON_DOWN_OFF          4
#define MES_DPAD_1_BUTTON_LEFT_ON           5
#define MES_DPAD_1_BUTTON_LEFT_OFF          6
#define MES_DPAD_1_BUTTON_RIGHT_ON          7
#define MES_DPAD_1_BUTTON_RIGHT_OFF         8
#define MES_DPAD_2_BUTTON_UP_ON             9
#define MES_DPAD_2_BUTTON_UP_OFF            10
#define MES_DPAD_2_BUTTON_DOWN_ON           11
#define MES_DPAD_2_BUTTON_DOWN_OFF          12
#define MES_DPAD_2_BUTTON_LEFT_ON           13
#define MES_DPAD_2_BUTTON_LEFT_OFF          14
#define MES_DPAD_2_BUTTON_RIGHT_ON          15
#define MES_DPAD_2_BUTTON_RIGHT_OFF         16

int pin0, pin8, pin12, pin16 = 0;

int drive = 0;

void onControllerEvent(MicroBitEvent e)
{
  if (e.value == MES_DPAD_2_BUTTON_UP_ON) {
      pin12 = 1;
      pin16 = 1;
      drive = 1;
  } else {
    if (e.value == MES_DPAD_2_BUTTON_UP_OFF) {
      pin12 = 0;
      pin16 = 0;
      drive = 0;
    }
  }

  if (drive == 1) {
      if (e.value == MES_DPAD_1_BUTTON_LEFT_ON) {
          pin12 = 1;
          pin16 = 0;
      } else {
          if (e.value == MES_DPAD_1_BUTTON_RIGHT_ON) {
              pin12 = 0;
              pin16 = 1;
          } else {
              if (e.value == MES_DPAD_1_BUTTON_LEFT_OFF || e.value == MES_DPAD_1_BUTTON_RIGHT_OFF) {
                  pin12 = 1;
                  pin16 = 1;
              } else {
              }
          }
      }
  }

  uBit.io.P0.setDigitalValue(pin0);
  uBit.io.P8.setDigitalValue(pin8);
  uBit.io.P12.setDigitalValue(pin12);
  uBit.io.P16.setDigitalValue(pin16);

}

int main()
{
    // Initialise the micro:bit runtime.
    uBit.init();

    uBit.display.scroll(&quot;BUGGY!&quot;);
    uBit.messageBus.listen(MES_DPAD_CONTROLLER, 0, onControllerEvent); 

    // If main exits, there may still be other fibers running or registered event handlers etc.
    // Simply release this fiber, which will mean we enter the scheduler. Worse case, we then
    // sit in the idle task forever, in a power efficient sleep.
    release_fiber();
}

#endif</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../iopin-service/" class="btn btn-neutral float-right" title="IOPinService">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../dfu-service/" class="btn btn-neutral" title="DFUService"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 <a href="https://microbit.vn">Microbit Việt Nam</a></p>
    
  </div>

  
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<!-- <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/microbitvn/help.microbit.vn" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../dfu-service/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../iopin-service/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div> -->

<script type="text/javascript">
  // If cookie is defined toggle the id
  if (typeof $.cookie('docToggle') !== 'undefined') {
      // Parse cookie which is an array
      var _parsed_cookie = JSON.parse($.cookie('docToggle'));
      // Loop over array and show hidden divs
      $.each(_parsed_cookie, function(index, value) {
          // Toggle
          $("[id='hidden_" + value + "']").css('display','');
      })
  }
</script>

</body>
</html>